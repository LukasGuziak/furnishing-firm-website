"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=i(require("jquery")):t.lightbox=i(t.jQuery)}(void 0,function(d){function t(t){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=d.extend({},this.constructor.defaults),this.option(t)}return t.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:600,fitImagesInViewport:!0,imageFadeDuration:600,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1,sanitizeTitle:!1},t.prototype.option=function(t){d.extend(this.options,t)},t.prototype.imageCountLabel=function(t,i){return this.options.albumLabel.replace(/%1/g,t).replace(/%2/g,i)},t.prototype.init=function(){var t=this;d(document).ready(function(){t.enable(),t.build()})},t.prototype.enable=function(){var i=this;d("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(t){return i.start(d(t.currentTarget)),!1})},t.prototype.build=function(){var i;0<d("#lightbox").length||(i=this,d('<div id="lightboxOverlay" tabindex="-1" class="lightboxOverlay"></div><div id="lightbox" tabindex="-1" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""/><div class="lb-nav"><a class="lb-prev" aria-label="Previous image" href="" ></a><a class="lb-next" aria-label="Next image" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo(d("body")),this.$lightbox=d("#lightbox"),this.$overlay=d("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.$image=this.$lightbox.find(".lb-image"),this.$nav=this.$lightbox.find(".lb-nav"),this.containerPadding={top:parseInt(this.$container.css("padding-top"),10),right:parseInt(this.$container.css("padding-right"),10),bottom:parseInt(this.$container.css("padding-bottom"),10),left:parseInt(this.$container.css("padding-left"),10)},this.imageBorderWidth={top:parseInt(this.$image.css("border-top-width"),10),right:parseInt(this.$image.css("border-right-width"),10),bottom:parseInt(this.$image.css("border-bottom-width"),10),left:parseInt(this.$image.css("border-left-width"),10)},this.$overlay.hide().on("click",function(){return i.end(),!1}),this.$lightbox.hide().on("click",function(t){"lightbox"===d(t.target).attr("id")&&i.end()}),this.$outerContainer.on("click",function(t){return"lightbox"===d(t.target).attr("id")&&i.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===i.currentImageIndex?i.changeImage(i.album.length-1):i.changeImage(i.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return i.currentImageIndex===i.album.length-1?i.changeImage(0):i.changeImage(i.currentImageIndex+1),!1}),this.$nav.on("mousedown",function(t){3===t.which&&(i.$nav.css("pointer-events","none"),i.$lightbox.one("contextmenu",function(){setTimeout(function(){this.$nav.css("pointer-events","auto")}.bind(i),0)}))}),this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){return i.end(),!1}))},t.prototype.start=function(t){var i=this,e=d(window),n=(e.on("resize",d.proxy(this.sizeOverlay,this)),this.sizeOverlay(),this.album=[],0);function o(t){i.album.push({alt:t.attr("data-alt"),link:t.attr("href"),title:t.attr("data-title")||t.attr("title")})}var a=t.attr("data-lightbox");if(a)for(var s=d(t.prop("tagName")+'[data-lightbox="'+a+'"]'),r=0;r<s.length;r=++r)o(d(s[r])),s[r]===t[0]&&(n=r);else if("lightbox"===t.attr("rel"))o(t);else{s=d(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]');for(var h=0;h<s.length;h=++h)o(d(s[h])),s[h]===t[0]&&(n=h)}a=e.scrollTop()+this.options.positionFromTop,e=e.scrollLeft();this.$lightbox.css({top:a+"px",left:e+"px"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&d("body").addClass("lb-disable-scrolling"),this.changeImage(n)},t.prototype.changeImage=function(o){var a=this,s=this.album[o].link,r=s.split(".").slice(-1)[0],h=this.$lightbox.find(".lb-image"),l=(this.disableKeyboardNav(),this.$overlay.fadeIn(this.options.fadeDuration),d(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating"),new Image);l.onload=function(){var t,i,e,n;h.attr({alt:a.album[o].alt,src:s}),d(l),h.width(l.width),h.height(l.height),n=d(window).width(),e=d(window).height(),n=n-a.containerPadding.left-a.containerPadding.right-a.imageBorderWidth.left-a.imageBorderWidth.right-20,e=e-a.containerPadding.top-a.containerPadding.bottom-a.imageBorderWidth.top-a.imageBorderWidth.bottom-a.options.positionFromTop-70,"svg"===r&&(h.width(n),h.height(e)),a.options.fitImagesInViewport?(a.options.maxWidth&&a.options.maxWidth<n&&(n=a.options.maxWidth),a.options.maxHeight&&a.options.maxHeight<e&&(e=a.options.maxHeight)):(n=a.options.maxWidth||l.width||n,e=a.options.maxHeight||l.height||e),(l.width>n||l.height>e)&&(l.width/n>l.height/e?(i=n,t=parseInt(l.height/(l.width/i),10)):(t=e,i=parseInt(l.width/(l.height/t),10)),h.width(i),h.height(t)),a.sizeContainer(h.width(),h.height())},l.src=this.album[o].link,this.currentImageIndex=o},t.prototype.sizeOverlay=function(){var t=this;setTimeout(function(){t.$overlay.width(d(document).width()).height(d(document).height())},0)},t.prototype.sizeContainer=function(t,i){var e=this,n=this.$outerContainer.outerWidth(),o=this.$outerContainer.outerHeight(),a=t+this.containerPadding.left+this.containerPadding.right+this.imageBorderWidth.left+this.imageBorderWidth.right,s=i+this.containerPadding.top+this.containerPadding.bottom+this.imageBorderWidth.top+this.imageBorderWidth.bottom;function r(){e.$lightbox.find(".lb-dataContainer").width(a),e.$lightbox.find(".lb-prevLink").height(s),e.$lightbox.find(".lb-nextLink").height(s),e.$overlay.focus(),e.showImage()}n!==a||o!==s?this.$outerContainer.animate({width:a,height:s},this.options.resizeDuration,"swing",function(){r()}):r()},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn(this.options.imageFadeDuration),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},t.prototype.updateNav=function(){var t=!1;try{document.createEvent("TouchEvent"),t=!!this.options.alwaysShowNavOnTouchDevices}catch(t){}this.$lightbox.find(".lb-nav").show(),1<this.album.length&&(this.options.wrapAround?(t&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(0<this.currentImageIndex&&(this.$lightbox.find(".lb-prev").show(),t&&this.$lightbox.find(".lb-prev").css("opacity","1")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),t&&this.$lightbox.find(".lb-next").css("opacity","1"))))},t.prototype.updateDetails=function(){var t,i=this;void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title&&(t=this.$lightbox.find(".lb-caption"),this.options.sanitizeTitle?t.text(this.album[this.currentImageIndex].title):t.html(this.album[this.currentImageIndex].title),t.fadeIn("fast")),1<this.album.length&&this.options.showImageNumberLabel?(t=this.imageCountLabel(this.currentImageIndex+1,this.album.length),this.$lightbox.find(".lb-number").text(t).fadeIn("fast")):this.$lightbox.find(".lb-number").hide(),this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return i.sizeOverlay()})},t.prototype.preloadNeighboringImages=function(){this.album.length>this.currentImageIndex+1&&((new Image).src=this.album[this.currentImageIndex+1].link),0<this.currentImageIndex&&((new Image).src=this.album[this.currentImageIndex-1].link)},t.prototype.enableKeyboardNav=function(){this.$lightbox.on("keyup.keyboard",d.proxy(this.keyboardAction,this)),this.$overlay.on("keyup.keyboard",d.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){this.$lightbox.off(".keyboard"),this.$overlay.off(".keyboard")},t.prototype.keyboardAction=function(t){var i=t.keyCode;27===i?(t.stopPropagation(),this.end()):37===i?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&1<this.album.length&&this.changeImage(this.album.length-1):39===i&&(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&1<this.album.length&&this.changeImage(0))},t.prototype.end=function(){this.disableKeyboardNav(),d(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),this.options.disableScrolling&&d("body").removeClass("lb-disable-scrolling")},new t});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpZ2h0Ym94LmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJqUXVlcnkiLCIkIiwiTGlnaHRib3giLCJvcHRpb25zIiwidGhpcyIsImFsYnVtIiwiY3VycmVudEltYWdlSW5kZXgiLCJleHRlbmQiLCJjb25zdHJ1Y3RvciIsImRlZmF1bHRzIiwiYWxidW1MYWJlbCIsImFsd2F5c1Nob3dOYXZPblRvdWNoRGV2aWNlcyIsImZhZGVEdXJhdGlvbiIsImZpdEltYWdlc0luVmlld3BvcnQiLCJwb3NpdGlvbkZyb21Ub3AiLCJyZXNpemVEdXJhdGlvbiIsInNob3dJbWFnZU51bWJlckxhYmVsIiwid3JhcEFyb3VuZCIsInNhbml0aXplVGl0bGUiLCJwcm90b3R5cGUiLCJvcHRpb24iLCJpbWFnZUNvdW50TGFiZWwiLCJjdXJyZW50SW1hZ2VOdW0iLCJ0b3RhbEltYWdlcyIsImluaXQiLCJkb2N1bWVudCIsInJlYWR5Iiwic2VsZiIsImVuYWJsZSIsIm9uIiwiZXZlbnQiLCJzdGFydCIsImN1cnJlbnRUYXJnZXQiLCJidWlsZCIsImFwcGVuZFRvIiwiJG92ZXJsYXkiLCIkb3V0ZXJDb250YWluZXIiLCIkY29udGFpbmVyIiwiJGxpZ2h0Ym94IiwiZmluZCIsIiRpbWFnZSIsIiRuYXYiLCJyaWdodCIsImJvdHRvbSIsInBhcnNlSW50IiwiY3NzIiwibGVmdCIsImltYWdlQm9yZGVyV2lkdGgiLCJoaWRlIiwiZW5kIiwidGFyZ2V0IiwiYXR0ciIsImNoYW5nZUltYWdlIiwibGVuZ3RoIiwid2hpY2giLCJvbmUiLCJzZXRUaW1lb3V0IiwiYmluZCIsIiR3aW5kb3ciLCJzaXplT3ZlcmxheSIsIiRsaW5rIiwibGluayIsInRpdGxlIiwid2luZG93IiwiaW1hZ2VOdW1iZXIiLCJwcm94eSIsIiRsaW5rcyIsImFkZFRvQWxidW0iLCJwcm9wIiwicHVzaCIsImFsdCIsImRhdGFMaWdodGJveFZhbHVlIiwiaSIsImoiLCJ0b3AiLCJzY3JvbGxUb3AiLCJzY3JvbGxMZWZ0IiwiZmFkZUluIiwiZmlsZW5hbWUiLCJkaXNhYmxlU2Nyb2xsaW5nIiwiZmlsZXR5cGUiLCJhZGRDbGFzcyIsImRpc2FibGVLZXlib2FyZE5hdiIsInByZWxvYWRlciIsIkltYWdlIiwic2xpY2UiLCJtYXhJbWFnZVdpZHRoIiwid2luZG93SGVpZ2h0Iiwid2luZG93V2lkdGgiLCIkcHJlbG9hZGVyIiwic3JjIiwid2lkdGgiLCJoZWlnaHQiLCJtYXhJbWFnZUhlaWdodCIsIm1heFdpZHRoIiwiY29udGFpbmVyUGFkZGluZyIsImltYWdlSGVpZ2h0IiwiaW1hZ2VXaWR0aCIsIm1heEhlaWdodCIsInNpemVDb250YWluZXIiLCJuZXdXaWR0aCIsInBvc3RSZXNpemUiLCJvdXRlcldpZHRoIiwib2xkSGVpZ2h0Iiwib3V0ZXJIZWlnaHQiLCJuZXdIZWlnaHQiLCJzaG93SW1hZ2UiLCJ1cGRhdGVOYXYiLCJmb2N1cyIsInByZWxvYWROZWlnaGJvcmluZ0ltYWdlcyIsIm9sZFdpZHRoIiwiYW5pbWF0ZSIsInN0b3AiLCJpbWFnZUZhZGVEdXJhdGlvbiIsInVwZGF0ZURldGFpbHMiLCJlbmFibGVLZXlib2FyZE5hdiIsImFsd2F5c1Nob3dOYXYiLCJjcmVhdGVFdmVudCIsImUiLCJzaG93IiwiJGNhcHRpb24iLCJsYWJlbFRleHQiLCJ0ZXh0IiwiaHRtbCIsInByZWxvYWROZXh0IiwicHJlbG9hZFByZXYiLCJyZW1vdmVDbGFzcyIsIm9mZiIsIktFWUNPREVfRVNDIiwiS0VZQ09ERV9MRUZUQVJST1ciLCJLRVlDT0RFX1JJR0hUQVJST1ciLCJzdG9wUHJvcGFnYXRpb24iLCJrZXlib2FyZEFjdGlvbiIsImtleWNvZGUiLCJrZXlDb2RlIiwiZmFkZU91dCJdLCJtYXBwaW5ncyI6IjhQQVdBLENBQUEsU0FBQUEsRUFBQUMsR0FDQSxZQUFBLE9BQUFDLFFBQUFBLE9BQUFDLElBR0NELE9BQUEsQ0FBQSxVQUF5QkQsQ0FBZkQs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LFlBQUFoRCxLQUFBRSxrQkFBQSxDQUFBLEVBUGVGLEtBQUtELFFBQVFjLFlBQWtDLEVBQXBCYixLQUFLQyxNQUFNZ0QsUUFrQnJEakQsS0FBV0YsWUFBWCxDQUFBLEVBZEMsRUFHREEsRUFBU2lCLFVBQVU4QixJQUFNLFdBQ3ZCN0MsS0FBSzhFLG1CQUFMLEVBQ0FqRixFQUFFOEQsTUFBRCxFQUFTZ0UsSUFBSSxTQUFVM0gsS0FBS3VELFdBQTdCLEVBQ0F2RCxLQUFLa0MsVUFBVWlHLFFBQVFuSSxLQUFLRCxRQUFRUyxZQUFwQyxFQUNBUixLQUFLK0IsU0FBU29HLFFBQVFuSSxLQUFLRCxRQUFRUyxZQUFuQyxFQUVJUixLQUFLRCxRQUFRNEUsa0JBQ2Y5RSxFQUFFLE1BQUQsRUFBUzZILFlBQVksc0JBQXRCLENBRUgsRUFFTSxJQUFJNUgsQ0FDWixDQTloQkQiLCJmaWxlIjoibGlnaHRib3gubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBMaWdodGJveCB2Mi4xMS4yXG4gKiBieSBMb2tlc2ggRGhha2FyXG4gKlxuICogTW9yZSBpbmZvOlxuICogaHR0cDovL2xva2VzaGRoYWthci5jb20vcHJvamVjdHMvbGlnaHRib3gyL1xuICpcbiAqIENvcHlyaWdodCBMb2tlc2ggRGhha2FyXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9sb2tlc2gvbGlnaHRib3gyL2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAqXG4gKiBAcHJlc2VydmVcbiAqL1xuXG4vLyBVc2VzIE5vZGUsIEFNRCBvciBicm93c2VyIGdsb2JhbHMgdG8gY3JlYXRlIGEgbW9kdWxlLlxuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXG4gICAgICAgIGRlZmluZShbJ2pxdWVyeSddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcbiAgICAgICAgLy8gb25seSBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB0aGF0IHN1cHBvcnQgbW9kdWxlLmV4cG9ydHMsXG4gICAgICAgIC8vIGxpa2UgTm9kZS5cbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHMgKHJvb3QgaXMgd2luZG93KVxuICAgICAgICByb290LmxpZ2h0Ym94ID0gZmFjdG9yeShyb290LmpRdWVyeSk7XG4gICAgfVxufSh0aGlzLCBmdW5jdGlvbiAoJCkge1xuXG4gIGZ1bmN0aW9uIExpZ2h0Ym94KG9wdGlvbnMpIHtcbiAgICB0aGlzLmFsYnVtID0gW107XG4gICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IHZvaWQgMDtcbiAgICB0aGlzLmluaXQoKTtcblxuICAgIC8vIG9wdGlvbnNcbiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5jb25zdHJ1Y3Rvci5kZWZhdWx0cyk7XG4gICAgdGhpcy5vcHRpb24ob3B0aW9ucyk7XG4gIH1cblxuICAvLyBEZXNjcmlwdGlvbnMgb2YgYWxsIG9wdGlvbnMgYXZhaWxhYmxlIG9uIHRoZSBkZW1vIHNpdGU6XG4gIC8vIGh0dHA6Ly9sb2tlc2hkaGFrYXIuY29tL3Byb2plY3RzL2xpZ2h0Ym94Mi9pbmRleC5odG1sI29wdGlvbnNcbiAgTGlnaHRib3guZGVmYXVsdHMgPSB7XG4gICAgYWxidW1MYWJlbDogJ0ltYWdlICUxIG9mICUyJyxcbiAgICBhbHdheXNTaG93TmF2T25Ub3VjaERldmljZXM6IGZhbHNlLFxuICAgIGZhZGVEdXJhdGlvbjogNjAwLFxuICAgIGZpdEltYWdlc0luVmlld3BvcnQ6IHRydWUsXG4gICAgaW1hZ2VGYWRlRHVyYXRpb246IDYwMCxcbiAgICAvLyBtYXhXaWR0aDogODAwLFxuICAgIC8vIG1heEhlaWdodDogNjAwLFxuICAgIHBvc2l0aW9uRnJvbVRvcDogNTAsXG4gICAgcmVzaXplRHVyYXRpb246IDcwMCxcbiAgICBzaG93SW1hZ2VOdW1iZXJMYWJlbDogdHJ1ZSxcbiAgICB3cmFwQXJvdW5kOiBmYWxzZSxcbiAgICBkaXNhYmxlU2Nyb2xsaW5nOiBmYWxzZSxcbiAgICAvKlxuICAgIFNhbml0aXplIFRpdGxlXG4gICAgSWYgdGhlIGNhcHRpb24gZGF0YSBpcyB0cnVzdGVkLCBmb3IgZXhhbXBsZSB5b3UgYXJlIGhhcmRjb2RpbmcgaXQgaW4sIHRoZW4gbGVhdmUgdGhpcyB0byBmYWxzZS5cbiAgICBUaGlzIHdpbGwgZnJlZSB5b3UgdG8gYWRkIGh0bWwgdGFncywgc3VjaCBhcyBsaW5rcywgaW4gdGhlIGNhcHRpb24uXG5cbiAgICBJZiB0aGUgY2FwdGlvbiBkYXRhIGlzIHVzZXIgc3VibWl0dGVkIG9yIGZyb20gc29tZSBvdGhlciB1bnRydXN0ZWQgc291cmNlLCB0aGVuIHNldCB0aGlzIHRvIHRydWVcbiAgICB0byBwcmV2ZW50IHhzcyBhbmQgb3RoZXIgaW5qZWN0aW9uIGF0dGFja3MuXG4gICAgICovXG4gICAgc2FuaXRpemVUaXRsZTogZmFsc2VcbiAgfTtcblxuICBMaWdodGJveC5wcm90b3R5cGUub3B0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICQuZXh0ZW5kKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmltYWdlQ291bnRMYWJlbCA9IGZ1bmN0aW9uKGN1cnJlbnRJbWFnZU51bSwgdG90YWxJbWFnZXMpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFsYnVtTGFiZWwucmVwbGFjZSgvJTEvZywgY3VycmVudEltYWdlTnVtKS5yZXBsYWNlKC8lMi9nLCB0b3RhbEltYWdlcyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gQm90aCBlbmFibGUgYW5kIGJ1aWxkIG1ldGhvZHMgcmVxdWlyZSB0aGUgYm9keSB0YWcgdG8gYmUgaW4gdGhlIERPTS5cbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuZW5hYmxlKCk7XG4gICAgICBzZWxmLmJ1aWxkKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gTG9vcCB0aHJvdWdoIGFuY2hvcnMgYW5kIGFyZWFtYXBzIGxvb2tpbmcgZm9yIGVpdGhlciBkYXRhLWxpZ2h0Ym94IGF0dHJpYnV0ZXMgb3IgcmVsIGF0dHJpYnV0ZXNcbiAgLy8gdGhhdCBjb250YWluICdsaWdodGJveCcuIFdoZW4gdGhlc2UgYXJlIGNsaWNrZWQsIHN0YXJ0IGxpZ2h0Ym94LlxuICBMaWdodGJveC5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnYVtyZWxePWxpZ2h0Ym94XSwgYXJlYVtyZWxePWxpZ2h0Ym94XSwgYVtkYXRhLWxpZ2h0Ym94XSwgYXJlYVtkYXRhLWxpZ2h0Ym94XScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBzZWxmLnN0YXJ0KCQoZXZlbnQuY3VycmVudFRhcmdldCkpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIEJ1aWxkIGh0bWwgZm9yIHRoZSBsaWdodGJveCBhbmQgdGhlIG92ZXJsYXkuXG4gIC8vIEF0dGFjaCBldmVudCBoYW5kbGVycyB0byB0aGUgbmV3IERPTSBlbGVtZW50cy4gY2xpY2sgY2xpY2sgY2xpY2tcbiAgTGlnaHRib3gucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCQoJyNsaWdodGJveCcpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIFRoZSB0d28gcm9vdCBub3RlcyBnZW5lcmF0ZWQsICNsaWdodGJveE92ZXJsYXkgYW5kICNsaWdodGJveCBhcmUgZ2l2ZW5cbiAgICAvLyB0YWJpbmRleCBhdHRycyBzbyB0aGV5IGFyZSBmb2N1c2FibGUuIFdlIGF0dGFjaCBvdXIga2V5Ym9hcmQgZXZlbnRcbiAgICAvLyBsaXN0ZW5lcnMgdG8gdGhlc2UgdHdvIGVsZW1lbnRzLCBhbmQgbm90IHRoZSBkb2N1bWVudC4gQ2xpY2tpbmcgYW55d2hlcmVcbiAgICAvLyB3aGlsZSBMaWdodGJveCBpcyBvcGVuZWQgd2lsbCBrZWVwIHRoZSBmb2N1cyBvbiBvciBpbnNpZGUgb25lIG9mIHRoZXNlXG4gICAgLy8gdHdvIGVsZW1lbnRzLlxuICAgIC8vXG4gICAgLy8gV2UgZG8gdGhpcyBzbyB3ZSBjYW4gcHJldmVudCBwcm9wb2dhdGlvbiBvZiB0aGUgRXNjIGtleXByZXNzIHdoZW5cbiAgICAvLyBMaWdodGJveCBpcyBvcGVuLiBUaGlzIHByZXZlbnRzIGl0IGZyb20gaW50ZWZlcmluZyB3aXRoIG90aGVyIGNvbXBvbmVudHNcbiAgICAvLyBvbiB0aGUgcGFnZSBiZWxvdy5cbiAgICAvL1xuICAgIC8vIEdpdGh1YiBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL2xva2VzaC9saWdodGJveDIvaXNzdWVzLzY2M1xuICAgICQoJzxkaXYgaWQ9XCJsaWdodGJveE92ZXJsYXlcIiB0YWJpbmRleD1cIi0xXCIgY2xhc3M9XCJsaWdodGJveE92ZXJsYXlcIj48L2Rpdj48ZGl2IGlkPVwibGlnaHRib3hcIiB0YWJpbmRleD1cIi0xXCIgY2xhc3M9XCJsaWdodGJveFwiPjxkaXYgY2xhc3M9XCJsYi1vdXRlckNvbnRhaW5lclwiPjxkaXYgY2xhc3M9XCJsYi1jb250YWluZXJcIj48aW1nIGNsYXNzPVwibGItaW1hZ2VcIiBzcmM9XCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFQLy8vd0FBQUNINUJBRUFBQUFBTEFBQUFBQUJBQUVBQUFJQ1JBRUFPdz09XCIgYWx0PVwiXCIvPjxkaXYgY2xhc3M9XCJsYi1uYXZcIj48YSBjbGFzcz1cImxiLXByZXZcIiBhcmlhLWxhYmVsPVwiUHJldmlvdXMgaW1hZ2VcIiBocmVmPVwiXCIgPjwvYT48YSBjbGFzcz1cImxiLW5leHRcIiBhcmlhLWxhYmVsPVwiTmV4dCBpbWFnZVwiIGhyZWY9XCJcIiA+PC9hPjwvZGl2PjxkaXYgY2xhc3M9XCJsYi1sb2FkZXJcIj48YSBjbGFzcz1cImxiLWNhbmNlbFwiPjwvYT48L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPVwibGItZGF0YUNvbnRhaW5lclwiPjxkaXYgY2xhc3M9XCJsYi1kYXRhXCI+PGRpdiBjbGFzcz1cImxiLWRldGFpbHNcIj48c3BhbiBjbGFzcz1cImxiLWNhcHRpb25cIj48L3NwYW4+PHNwYW4gY2xhc3M9XCJsYi1udW1iZXJcIj48L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz1cImxiLWNsb3NlQ29udGFpbmVyXCI+PGEgY2xhc3M9XCJsYi1jbG9zZVwiPjwvYT48L2Rpdj48L2Rpdj48L2Rpdj48L2Rpdj4nKS5hcHBlbmRUbygkKCdib2R5JykpO1xuXG4gICAgLy8gQ2FjaGUgalF1ZXJ5IG9iamVjdHNcbiAgICB0aGlzLiRsaWdodGJveCAgICAgICA9ICQoJyNsaWdodGJveCcpO1xuICAgIHRoaXMuJG92ZXJsYXkgICAgICAgID0gJCgnI2xpZ2h0Ym94T3ZlcmxheScpO1xuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW91dGVyQ29udGFpbmVyJyk7XG4gICAgdGhpcy4kY29udGFpbmVyICAgICAgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY29udGFpbmVyJyk7XG4gICAgdGhpcy4kaW1hZ2UgICAgICAgICAgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UnKTtcbiAgICB0aGlzLiRuYXYgICAgICAgICAgICA9IHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uYXYnKTtcblxuICAgIC8vIFN0b3JlIGNzcyB2YWx1ZXMgZm9yIGZ1dHVyZSBsb29rdXBcbiAgICB0aGlzLmNvbnRhaW5lclBhZGRpbmcgPSB7XG4gICAgICB0b3A6IHBhcnNlSW50KHRoaXMuJGNvbnRhaW5lci5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKSxcbiAgICAgIHJpZ2h0OiBwYXJzZUludCh0aGlzLiRjb250YWluZXIuY3NzKCdwYWRkaW5nLXJpZ2h0JyksIDEwKSxcbiAgICAgIGJvdHRvbTogcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1ib3R0b20nKSwgMTApLFxuICAgICAgbGVmdDogcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1sZWZ0JyksIDEwKVxuICAgIH07XG5cbiAgICB0aGlzLmltYWdlQm9yZGVyV2lkdGggPSB7XG4gICAgICB0b3A6IHBhcnNlSW50KHRoaXMuJGltYWdlLmNzcygnYm9yZGVyLXRvcC13aWR0aCcpLCAxMCksXG4gICAgICByaWdodDogcGFyc2VJbnQodGhpcy4kaW1hZ2UuY3NzKCdib3JkZXItcmlnaHQtd2lkdGgnKSwgMTApLFxuICAgICAgYm90dG9tOiBwYXJzZUludCh0aGlzLiRpbWFnZS5jc3MoJ2JvcmRlci1ib3R0b20td2lkdGgnKSwgMTApLFxuICAgICAgbGVmdDogcGFyc2VJbnQodGhpcy4kaW1hZ2UuY3NzKCdib3JkZXItbGVmdC13aWR0aCcpLCAxMClcbiAgICB9O1xuXG4gICAgLy8gQXR0YWNoIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBuZXdseSBtaW50ZWQgRE9NIGVsZW1lbnRzXG4gICAgdGhpcy4kb3ZlcmxheS5oaWRlKCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVuZCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kbGlnaHRib3guaGlkZSgpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gMCkge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuYWxidW0ubGVuZ3RoIC0gMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggLSAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gc2VsZi5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHNlbGYuY2hhbmdlSW1hZ2UoMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggKyAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8qXG4gICAgICBTaG93IGNvbnRleHQgbWVudSBmb3IgaW1hZ2Ugb24gcmlnaHQtY2xpY2tcblxuICAgICAgVGhlcmUgaXMgYSBkaXYgY29udGFpbmluZyB0aGUgbmF2aWdhdGlvbiB0aGF0IHNwYW5zIHRoZSBlbnRpcmUgaW1hZ2UgYW5kIGxpdmVzIGFib3ZlIG9mIGl0LiBJZlxuICAgICAgeW91IHJpZ2h0LWNsaWNrLCB5b3UgYXJlIHJpZ2h0IGNsaWNraW5nIHRoaXMgZGl2IGFuZCBub3QgdGhlIGltYWdlLiBUaGlzIHByZXZlbnRzIHVzZXJzIGZyb21cbiAgICAgIHNhdmluZyB0aGUgaW1hZ2Ugb3IgdXNpbmcgb3RoZXIgY29udGV4dCBtZW51IGFjdGlvbnMgd2l0aCB0aGUgaW1hZ2UuXG5cbiAgICAgIFRvIGZpeCB0aGlzLCB3aGVuIHdlIGRldGVjdCB0aGUgcmlnaHQgbW91c2UgYnV0dG9uIGlzIHByZXNzZWQgZG93biwgYnV0IG5vdCB5ZXQgY2xpY2tlZCwgd2VcbiAgICAgIHNldCBwb2ludGVyLWV2ZW50cyB0byBub25lIG9uIHRoZSBuYXYgZGl2LiBUaGlzIGlzIHNvIHRoYXQgdGhlIHVwY29taW5nIHJpZ2h0LWNsaWNrIGV2ZW50IG9uXG4gICAgICB0aGUgbmV4dCBtb3VzZXVwIHdpbGwgYnViYmxlIGRvd24gdG8gdGhlIGltYWdlLiBPbmNlIHRoZSByaWdodC1jbGljay9jb250ZXh0bWVudSBldmVudCBvY2N1cnNcbiAgICAgIHdlIHNldCB0aGUgcG9pbnRlciBldmVudHMgYmFjayB0byBhdXRvIGZvciB0aGUgbmF2IGRpdiBzbyBpdCBjYW4gY2FwdHVyZSBob3ZlciBhbmQgbGVmdC1jbGlja1xuICAgICAgZXZlbnRzIGFzIHVzdWFsLlxuICAgICAqL1xuICAgIHRoaXMuJG5hdi5vbignbW91c2Vkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIGlmIChldmVudC53aGljaCA9PT0gMykge1xuICAgICAgICBzZWxmLiRuYXYuY3NzKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7XG5cbiAgICAgICAgc2VsZi4kbGlnaHRib3gub25lKCdjb250ZXh0bWVudScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHRoaXMuJG5hdi5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ2F1dG8nKTtcbiAgICAgICAgICB9LmJpbmQoc2VsZiksIDApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlciwgLmxiLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVuZCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIFNob3cgb3ZlcmxheSBhbmQgbGlnaHRib3guIElmIHRoZSBpbWFnZSBpcyBwYXJ0IG9mIGEgc2V0LCBhZGQgc2libGluZ3MgdG8gYWxidW0gYXJyYXkuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCRsaW5rKSB7XG4gICAgdmFyIHNlbGYgICAgPSB0aGlzO1xuICAgIHZhciAkd2luZG93ID0gJCh3aW5kb3cpO1xuXG4gICAgJHdpbmRvdy5vbigncmVzaXplJywgJC5wcm94eSh0aGlzLnNpemVPdmVybGF5LCB0aGlzKSk7XG5cbiAgICB0aGlzLnNpemVPdmVybGF5KCk7XG5cbiAgICB0aGlzLmFsYnVtID0gW107XG4gICAgdmFyIGltYWdlTnVtYmVyID0gMDtcblxuICAgIGZ1bmN0aW9uIGFkZFRvQWxidW0oJGxpbmspIHtcbiAgICAgIHNlbGYuYWxidW0ucHVzaCh7XG4gICAgICAgIGFsdDogJGxpbmsuYXR0cignZGF0YS1hbHQnKSxcbiAgICAgICAgbGluazogJGxpbmsuYXR0cignaHJlZicpLFxuICAgICAgICB0aXRsZTogJGxpbmsuYXR0cignZGF0YS10aXRsZScpIHx8ICRsaW5rLmF0dHIoJ3RpdGxlJylcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFN1cHBvcnQgYm90aCBkYXRhLWxpZ2h0Ym94IGF0dHJpYnV0ZSBhbmQgcmVsIGF0dHJpYnV0ZSBpbXBsZW1lbnRhdGlvbnNcbiAgICB2YXIgZGF0YUxpZ2h0Ym94VmFsdWUgPSAkbGluay5hdHRyKCdkYXRhLWxpZ2h0Ym94Jyk7XG4gICAgdmFyICRsaW5rcztcblxuICAgIGlmIChkYXRhTGlnaHRib3hWYWx1ZSkge1xuICAgICAgJGxpbmtzID0gJCgkbGluay5wcm9wKCd0YWdOYW1lJykgKyAnW2RhdGEtbGlnaHRib3g9XCInICsgZGF0YUxpZ2h0Ym94VmFsdWUgKyAnXCJdJyk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRsaW5rcy5sZW5ndGg7IGkgPSArK2kpIHtcbiAgICAgICAgYWRkVG9BbGJ1bSgkKCRsaW5rc1tpXSkpO1xuICAgICAgICBpZiAoJGxpbmtzW2ldID09PSAkbGlua1swXSkge1xuICAgICAgICAgIGltYWdlTnVtYmVyID0gaTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoJGxpbmsuYXR0cigncmVsJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgLy8gSWYgaW1hZ2UgaXMgbm90IHBhcnQgb2YgYSBzZXRcbiAgICAgICAgYWRkVG9BbGJ1bSgkbGluayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBpbWFnZSBpcyBwYXJ0IG9mIGEgc2V0XG4gICAgICAgICRsaW5rcyA9ICQoJGxpbmsucHJvcCgndGFnTmFtZScpICsgJ1tyZWw9XCInICsgJGxpbmsuYXR0cigncmVsJykgKyAnXCJdJyk7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgJGxpbmtzLmxlbmd0aDsgaiA9ICsraikge1xuICAgICAgICAgIGFkZFRvQWxidW0oJCgkbGlua3Nbal0pKTtcbiAgICAgICAgICBpZiAoJGxpbmtzW2pdID09PSAkbGlua1swXSkge1xuICAgICAgICAgICAgaW1hZ2VOdW1iZXIgPSBqO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFBvc2l0aW9uIExpZ2h0Ym94XG4gICAgdmFyIHRvcCAgPSAkd2luZG93LnNjcm9sbFRvcCgpICsgdGhpcy5vcHRpb25zLnBvc2l0aW9uRnJvbVRvcDtcbiAgICB2YXIgbGVmdCA9ICR3aW5kb3cuc2Nyb2xsTGVmdCgpO1xuICAgIHRoaXMuJGxpZ2h0Ym94LmNzcyh7XG4gICAgICB0b3A6IHRvcCArICdweCcsXG4gICAgICBsZWZ0OiBsZWZ0ICsgJ3B4J1xuICAgIH0pLmZhZGVJbih0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcblxuICAgIC8vIERpc2FibGUgc2Nyb2xsaW5nIG9mIHRoZSBwYWdlIHdoaWxlIG9wZW5cbiAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVTY3JvbGxpbmcpIHtcbiAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnbGItZGlzYWJsZS1zY3JvbGxpbmcnKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZUltYWdlKGltYWdlTnVtYmVyKTtcbiAgfTtcblxuICAvLyBIaWRlIG1vc3QgVUkgZWxlbWVudHMgaW4gcHJlcGFyYXRpb24gZm9yIHRoZSBhbmltYXRlZCByZXNpemluZyBvZiB0aGUgbGlnaHRib3guXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5jaGFuZ2VJbWFnZSA9IGZ1bmN0aW9uKGltYWdlTnVtYmVyKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBmaWxlbmFtZSA9IHRoaXMuYWxidW1baW1hZ2VOdW1iZXJdLmxpbms7XG4gICAgdmFyIGZpbGV0eXBlID0gZmlsZW5hbWUuc3BsaXQoJy4nKS5zbGljZSgtMSlbMF07XG4gICAgdmFyICRpbWFnZSA9IHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZScpO1xuXG4gICAgLy8gRGlzYWJsZSBrZXlib2FyZCBuYXYgZHVyaW5nIHRyYW5zaXRpb25zXG4gICAgdGhpcy5kaXNhYmxlS2V5Ym9hcmROYXYoKTtcblxuICAgIC8vIFNob3cgbG9hZGluZyBzdGF0ZVxuICAgIHRoaXMuJG92ZXJsYXkuZmFkZUluKHRoaXMub3B0aW9ucy5mYWRlRHVyYXRpb24pO1xuICAgICQoJy5sYi1sb2FkZXInKS5mYWRlSW4oJ3Nsb3cnKTtcbiAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UsIC5sYi1uYXYsIC5sYi1wcmV2LCAubGItbmV4dCwgLmxiLWRhdGFDb250YWluZXIsIC5sYi1udW1iZXJzLCAubGItY2FwdGlvbicpLmhpZGUoKTtcbiAgICB0aGlzLiRvdXRlckNvbnRhaW5lci5hZGRDbGFzcygnYW5pbWF0aW5nJyk7XG5cbiAgICAvLyBXaGVuIGltYWdlIHRvIHNob3cgaXMgcHJlbG9hZGVkLCB3ZSBzZW5kIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IHRvIHNpemVDb250YWluZXIoKVxuICAgIHZhciBwcmVsb2FkZXIgPSBuZXcgSW1hZ2UoKTtcbiAgICBwcmVsb2FkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgJHByZWxvYWRlcjtcbiAgICAgIHZhciBpbWFnZUhlaWdodDtcbiAgICAgIHZhciBpbWFnZVdpZHRoO1xuICAgICAgdmFyIG1heEltYWdlSGVpZ2h0O1xuICAgICAgdmFyIG1heEltYWdlV2lkdGg7XG4gICAgICB2YXIgd2luZG93SGVpZ2h0O1xuICAgICAgdmFyIHdpbmRvd1dpZHRoO1xuXG4gICAgICAkaW1hZ2UuYXR0cih7XG4gICAgICAgICdhbHQnOiBzZWxmLmFsYnVtW2ltYWdlTnVtYmVyXS5hbHQsXG4gICAgICAgICdzcmMnOiBmaWxlbmFtZVxuICAgICAgfSk7XG5cbiAgICAgICRwcmVsb2FkZXIgPSAkKHByZWxvYWRlcik7XG5cbiAgICAgICRpbWFnZS53aWR0aChwcmVsb2FkZXIud2lkdGgpO1xuICAgICAgJGltYWdlLmhlaWdodChwcmVsb2FkZXIuaGVpZ2h0KTtcbiAgICAgIHdpbmRvd1dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgICB3aW5kb3dIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgbWF4IGltYWdlIGRpbWVuc2lvbnMgZm9yIHRoZSBjdXJyZW50IHZpZXdwb3J0LlxuICAgICAgLy8gVGFrZSBpbnRvIGFjY291bnQgdGhlIGJvcmRlciBhcm91bmQgdGhlIGltYWdlIGFuZCBhbiBhZGRpdGlvbmFsIDEwcHggZ3V0dGVyIG9uIGVhY2ggc2lkZS5cbiAgICAgIG1heEltYWdlV2lkdGggID0gd2luZG93V2lkdGggLSBzZWxmLmNvbnRhaW5lclBhZGRpbmcubGVmdCAtIHNlbGYuY29udGFpbmVyUGFkZGluZy5yaWdodCAtIHNlbGYuaW1hZ2VCb3JkZXJXaWR0aC5sZWZ0IC0gc2VsZi5pbWFnZUJvcmRlcldpZHRoLnJpZ2h0IC0gMjA7XG4gICAgICBtYXhJbWFnZUhlaWdodCA9IHdpbmRvd0hlaWdodCAtIHNlbGYuY29udGFpbmVyUGFkZGluZy50b3AgLSBzZWxmLmNvbnRhaW5lclBhZGRpbmcuYm90dG9tIC0gc2VsZi5pbWFnZUJvcmRlcldpZHRoLnRvcCAtIHNlbGYuaW1hZ2VCb3JkZXJXaWR0aC5ib3R0b20gLSBzZWxmLm9wdGlvbnMucG9zaXRpb25Gcm9tVG9wIC0gNzA7XG5cbiAgICAgIC8qXG4gICAgICBTaW5jZSBtYW55IFNWR3MgaGF2ZSBzbWFsbCBpbnRyaW5zaWMgZGltZW5zaW9ucywgYnV0IHRoZXkgc3VwcG9ydCBzY2FsaW5nXG4gICAgICB1cCB3aXRob3V0IHF1YWxpdHkgbG9zcyBiZWNhdXNlIG9mIHRoZWlyIHZlY3RvciBmb3JtYXQsIG1heCBvdXQgdGhlaXJcbiAgICAgIHNpemUuXG4gICAgICAqL1xuICAgICAgaWYgKGZpbGV0eXBlID09PSAnc3ZnJykge1xuICAgICAgICAkaW1hZ2Uud2lkdGgobWF4SW1hZ2VXaWR0aCk7XG4gICAgICAgICRpbWFnZS5oZWlnaHQobWF4SW1hZ2VIZWlnaHQpO1xuICAgICAgfVxuXG4gICAgICAvLyBGaXQgaW1hZ2UgaW5zaWRlIHRoZSB2aWV3cG9ydC5cbiAgICAgIGlmIChzZWxmLm9wdGlvbnMuZml0SW1hZ2VzSW5WaWV3cG9ydCkge1xuXG4gICAgICAgIC8vIENoZWNrIGlmIGltYWdlIHNpemUgaXMgbGFyZ2VyIHRoZW4gbWF4V2lkdGh8bWF4SGVpZ2h0IGluIHNldHRpbmdzXG4gICAgICAgIGlmIChzZWxmLm9wdGlvbnMubWF4V2lkdGggJiYgc2VsZi5vcHRpb25zLm1heFdpZHRoIDwgbWF4SW1hZ2VXaWR0aCkge1xuICAgICAgICAgIG1heEltYWdlV2lkdGggPSBzZWxmLm9wdGlvbnMubWF4V2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5tYXhIZWlnaHQgJiYgc2VsZi5vcHRpb25zLm1heEhlaWdodCA8IG1heEltYWdlSGVpZ2h0KSB7XG4gICAgICAgICAgbWF4SW1hZ2VIZWlnaHQgPSBzZWxmLm9wdGlvbnMubWF4SGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1heEltYWdlV2lkdGggPSBzZWxmLm9wdGlvbnMubWF4V2lkdGggfHwgcHJlbG9hZGVyLndpZHRoIHx8IG1heEltYWdlV2lkdGg7XG4gICAgICAgIG1heEltYWdlSGVpZ2h0ID0gc2VsZi5vcHRpb25zLm1heEhlaWdodCB8fCBwcmVsb2FkZXIuaGVpZ2h0IHx8IG1heEltYWdlSGVpZ2h0O1xuICAgICAgfVxuXG4gICAgICAvLyBJcyB0aGUgY3VycmVudCBpbWFnZSdzIHdpZHRoIG9yIGhlaWdodCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heEltYWdlV2lkdGggb3IgbWF4SW1hZ2VIZWlnaHRcbiAgICAgIC8vIG9wdGlvbiB0aGFuIHdlIG5lZWQgdG8gc2l6ZSBkb3duIHdoaWxlIG1haW50YWluaW5nIHRoZSBhc3BlY3QgcmF0aW8uXG4gICAgICBpZiAoKHByZWxvYWRlci53aWR0aCA+IG1heEltYWdlV2lkdGgpIHx8IChwcmVsb2FkZXIuaGVpZ2h0ID4gbWF4SW1hZ2VIZWlnaHQpKSB7XG4gICAgICAgIGlmICgocHJlbG9hZGVyLndpZHRoIC8gbWF4SW1hZ2VXaWR0aCkgPiAocHJlbG9hZGVyLmhlaWdodCAvIG1heEltYWdlSGVpZ2h0KSkge1xuICAgICAgICAgIGltYWdlV2lkdGggID0gbWF4SW1hZ2VXaWR0aDtcbiAgICAgICAgICBpbWFnZUhlaWdodCA9IHBhcnNlSW50KHByZWxvYWRlci5oZWlnaHQgLyAocHJlbG9hZGVyLndpZHRoIC8gaW1hZ2VXaWR0aCksIDEwKTtcbiAgICAgICAgICAkaW1hZ2Uud2lkdGgoaW1hZ2VXaWR0aCk7XG4gICAgICAgICAgJGltYWdlLmhlaWdodChpbWFnZUhlaWdodCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW1hZ2VIZWlnaHQgPSBtYXhJbWFnZUhlaWdodDtcbiAgICAgICAgICBpbWFnZVdpZHRoID0gcGFyc2VJbnQocHJlbG9hZGVyLndpZHRoIC8gKHByZWxvYWRlci5oZWlnaHQgLyBpbWFnZUhlaWdodCksIDEwKTtcbiAgICAgICAgICAkaW1hZ2Uud2lkdGgoaW1hZ2VXaWR0aCk7XG4gICAgICAgICAgJGltYWdlLmhlaWdodChpbWFnZUhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHNlbGYuc2l6ZUNvbnRhaW5lcigkaW1hZ2Uud2lkdGgoKSwgJGltYWdlLmhlaWdodCgpKTtcbiAgICB9O1xuXG4gICAgLy8gUHJlbG9hZCBpbWFnZSBiZWZvcmUgc2hvd2luZ1xuICAgIHByZWxvYWRlci5zcmMgPSB0aGlzLmFsYnVtW2ltYWdlTnVtYmVyXS5saW5rO1xuICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBpbWFnZU51bWJlcjtcbiAgfTtcblxuICAvLyBTdHJldGNoIG92ZXJsYXkgdG8gZml0IHRoZSB2aWV3cG9ydFxuICBMaWdodGJveC5wcm90b3R5cGUuc2l6ZU92ZXJsYXkgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLypcbiAgICBXZSB1c2UgYSBzZXRUaW1lb3V0IDAgdG8gcGF1c2UgSlMgZXhlY3V0aW9uIGFuZCBsZXQgdGhlIHJlbmRlcmluZyBjYXRjaC11cC5cbiAgICBXaHkgZG8gdGhpcz8gSWYgdGhlIGBkaXNhYmxlU2Nyb2xsaW5nYCBvcHRpb24gaXMgc2V0IHRvIHRydWUsIGEgY2xhc3MgaXMgYWRkZWQgdG8gdGhlIGJvZHlcbiAgICB0YWcgdGhhdCBkaXNhYmxlcyBzY3JvbGxpbmcgYW5kIGhpZGVzIHRoZSBzY3JvbGxiYXIuIFdlIHdhbnQgdG8gbWFrZSBzdXJlIHRoZSBzY3JvbGxiYXIgaXNcbiAgICBoaWRkZW4gYmVmb3JlIHdlIG1lYXN1cmUgdGhlIGRvY3VtZW50IHdpZHRoLCBhcyB0aGUgcHJlc2VuY2Ugb2YgdGhlIHNjcm9sbGJhciB3aWxsIGFmZmVjdCB0aGVcbiAgICBudW1iZXIuXG4gICAgKi9cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi4kb3ZlcmxheVxuICAgICAgICAud2lkdGgoJChkb2N1bWVudCkud2lkdGgoKSlcbiAgICAgICAgLmhlaWdodCgkKGRvY3VtZW50KS5oZWlnaHQoKSk7XG5cbiAgICB9LCAwKTtcbiAgfTtcblxuICAvLyBBbmltYXRlIHRoZSBzaXplIG9mIHRoZSBsaWdodGJveCB0byBmaXQgdGhlIGltYWdlIHdlIGFyZSBzaG93aW5nXG4gIC8vIFRoaXMgbWV0aG9kIGFsc28gc2hvd3MgdGhlIHRoZSBpbWFnZS5cbiAgTGlnaHRib3gucHJvdG90eXBlLnNpemVDb250YWluZXIgPSBmdW5jdGlvbihpbWFnZVdpZHRoLCBpbWFnZUhlaWdodCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciBvbGRXaWR0aCAgPSB0aGlzLiRvdXRlckNvbnRhaW5lci5vdXRlcldpZHRoKCk7XG4gICAgdmFyIG9sZEhlaWdodCA9IHRoaXMuJG91dGVyQ29udGFpbmVyLm91dGVySGVpZ2h0KCk7XG4gICAgdmFyIG5ld1dpZHRoICA9IGltYWdlV2lkdGggKyB0aGlzLmNvbnRhaW5lclBhZGRpbmcubGVmdCArIHRoaXMuY29udGFpbmVyUGFkZGluZy5yaWdodCArIHRoaXMuaW1hZ2VCb3JkZXJXaWR0aC5sZWZ0ICsgdGhpcy5pbWFnZUJvcmRlcldpZHRoLnJpZ2h0O1xuICAgIHZhciBuZXdIZWlnaHQgPSBpbWFnZUhlaWdodCArIHRoaXMuY29udGFpbmVyUGFkZGluZy50b3AgKyB0aGlzLmNvbnRhaW5lclBhZGRpbmcuYm90dG9tICsgdGhpcy5pbWFnZUJvcmRlcldpZHRoLnRvcCArIHRoaXMuaW1hZ2VCb3JkZXJXaWR0aC5ib3R0b207XG5cbiAgICBmdW5jdGlvbiBwb3N0UmVzaXplKCkge1xuICAgICAgc2VsZi4kbGlnaHRib3guZmluZCgnLmxiLWRhdGFDb250YWluZXInKS53aWR0aChuZXdXaWR0aCk7XG4gICAgICBzZWxmLiRsaWdodGJveC5maW5kKCcubGItcHJldkxpbmsnKS5oZWlnaHQobmV3SGVpZ2h0KTtcbiAgICAgIHNlbGYuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0TGluaycpLmhlaWdodChuZXdIZWlnaHQpO1xuXG4gICAgICAvLyBTZXQgZm9jdXMgb24gb25lIG9mIHRoZSB0d28gcm9vdCBub2RlcyBzbyBrZXlib2FyZCBldmVudHMgYXJlIGNhcHR1cmVkLlxuICAgICAgc2VsZi4kb3ZlcmxheS5mb2N1cygpO1xuXG4gICAgICBzZWxmLnNob3dJbWFnZSgpO1xuICAgIH1cblxuICAgIGlmIChvbGRXaWR0aCAhPT0gbmV3V2lkdGggfHwgb2xkSGVpZ2h0ICE9PSBuZXdIZWlnaHQpIHtcbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFuaW1hdGUoe1xuICAgICAgICB3aWR0aDogbmV3V2lkdGgsXG4gICAgICAgIGhlaWdodDogbmV3SGVpZ2h0XG4gICAgICB9LCB0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sICdzd2luZycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBwb3N0UmVzaXplKCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9zdFJlc2l6ZSgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBEaXNwbGF5IHRoZSBpbWFnZSBhbmQgaXRzIGRldGFpbHMgYW5kIGJlZ2luIHByZWxvYWQgbmVpZ2hib3JpbmcgaW1hZ2VzLlxuICBMaWdodGJveC5wcm90b3R5cGUuc2hvd0ltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlcicpLnN0b3AodHJ1ZSkuaGlkZSgpO1xuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZScpLmZhZGVJbih0aGlzLm9wdGlvbnMuaW1hZ2VGYWRlRHVyYXRpb24pO1xuXG4gICAgdGhpcy51cGRhdGVOYXYoKTtcbiAgICB0aGlzLnVwZGF0ZURldGFpbHMoKTtcbiAgICB0aGlzLnByZWxvYWROZWlnaGJvcmluZ0ltYWdlcygpO1xuICAgIHRoaXMuZW5hYmxlS2V5Ym9hcmROYXYoKTtcbiAgfTtcblxuICAvLyBEaXNwbGF5IHByZXZpb3VzIGFuZCBuZXh0IG5hdmlnYXRpb24gaWYgYXBwcm9wcmlhdGUuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS51cGRhdGVOYXYgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgdG91Y2ggZXZlbnRzLiBJZiBzbywgd2UgdGFrZSB0aGUgY29uc2VydmF0aXZlIGFwcHJvYWNoXG4gICAgLy8gYW5kIGFzc3VtZSB0aGF0IG1vdXNlIGhvdmVyIGV2ZW50cyBhcmUgbm90IHN1cHBvcnRlZCBhbmQgYWx3YXlzIHNob3cgcHJldi9uZXh0IG5hdmlnYXRpb25cbiAgICAvLyBhcnJvd3MgaW4gaW1hZ2Ugc2V0cy5cbiAgICB2YXIgYWx3YXlzU2hvd05hdiA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBkb2N1bWVudC5jcmVhdGVFdmVudCgnVG91Y2hFdmVudCcpO1xuICAgICAgYWx3YXlzU2hvd05hdiA9ICh0aGlzLm9wdGlvbnMuYWx3YXlzU2hvd05hdk9uVG91Y2hEZXZpY2VzKSA/IHRydWUgOiBmYWxzZTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5hdicpLnNob3coKTtcblxuICAgIGlmICh0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCkge1xuICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2LCAubGItbmV4dCcpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYsIC5sYi1uZXh0Jykuc2hvdygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPiAwKSB7XG4gICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYnKS5zaG93KCk7XG4gICAgICAgICAgaWYgKGFsd2F5c1Nob3dOYXYpIHtcbiAgICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2JykuY3NzKCdvcGFjaXR5JywgJzEnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPCB0aGlzLmFsYnVtLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbmV4dCcpLnNob3coKTtcbiAgICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5leHQnKS5jc3MoJ29wYWNpdHknLCAnMScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBEaXNwbGF5IGNhcHRpb24sIGltYWdlIG51bWJlciwgYW5kIGNsb3NpbmcgYnV0dG9uLlxuICBMaWdodGJveC5wcm90b3R5cGUudXBkYXRlRGV0YWlscyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIEVuYWJsZSBhbmNob3IgY2xpY2tzIGluIHRoZSBpbmplY3RlZCBjYXB0aW9uIGh0bWwuXG4gICAgLy8gVGhhbmtzIE5hdGUgV3JpZ2h0IGZvciB0aGUgZml4LiBAaHR0cHM6Ly9naXRodWIuY29tL05hdGVXclxuICAgIGlmICh0eXBlb2YgdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgIHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0udGl0bGUgIT09ICcnKSB7XG4gICAgICB2YXIgJGNhcHRpb24gPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY2FwdGlvbicpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zYW5pdGl6ZVRpdGxlKSB7XG4gICAgICAgICRjYXB0aW9uLnRleHQodGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkY2FwdGlvbi5odG1sKHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0udGl0bGUpO1xuICAgICAgfVxuICAgICAgJGNhcHRpb24uZmFkZUluKCdmYXN0Jyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYWxidW0ubGVuZ3RoID4gMSAmJiB0aGlzLm9wdGlvbnMuc2hvd0ltYWdlTnVtYmVyTGFiZWwpIHtcbiAgICAgIHZhciBsYWJlbFRleHQgPSB0aGlzLmltYWdlQ291bnRMYWJlbCh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSwgdGhpcy5hbGJ1bS5sZW5ndGgpO1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLnRleHQobGFiZWxUZXh0KS5mYWRlSW4oJ2Zhc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLmhpZGUoKTtcbiAgICB9XG5cbiAgICB0aGlzLiRvdXRlckNvbnRhaW5lci5yZW1vdmVDbGFzcygnYW5pbWF0aW5nJyk7XG5cbiAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItZGF0YUNvbnRhaW5lcicpLmZhZGVJbih0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHNlbGYuc2l6ZU92ZXJsYXkoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBQcmVsb2FkIHByZXZpb3VzIGFuZCBuZXh0IGltYWdlcyBpbiBzZXQuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5wcmVsb2FkTmVpZ2hib3JpbmdJbWFnZXMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5hbGJ1bS5sZW5ndGggPiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSkge1xuICAgICAgdmFyIHByZWxvYWROZXh0ID0gbmV3IEltYWdlKCk7XG4gICAgICBwcmVsb2FkTmV4dC5zcmMgPSB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXggKyAxXS5saW5rO1xuICAgIH1cbiAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCA+IDApIHtcbiAgICAgIHZhciBwcmVsb2FkUHJldiA9IG5ldyBJbWFnZSgpO1xuICAgICAgcHJlbG9hZFByZXYuc3JjID0gdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4IC0gMV0ubGluaztcbiAgICB9XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmVuYWJsZUtleWJvYXJkTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3gub24oJ2tleXVwLmtleWJvYXJkJywgJC5wcm94eSh0aGlzLmtleWJvYXJkQWN0aW9uLCB0aGlzKSk7XG4gICAgdGhpcy4kb3ZlcmxheS5vbigna2V5dXAua2V5Ym9hcmQnLCAkLnByb3h5KHRoaXMua2V5Ym9hcmRBY3Rpb24sIHRoaXMpKTtcbiAgfTtcblxuICBMaWdodGJveC5wcm90b3R5cGUuZGlzYWJsZUtleWJvYXJkTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3gub2ZmKCcua2V5Ym9hcmQnKTtcbiAgICB0aGlzLiRvdmVybGF5Lm9mZignLmtleWJvYXJkJyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmtleWJvYXJkQWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgS0VZQ09ERV9FU0MgICAgICAgID0gMjc7XG4gICAgdmFyIEtFWUNPREVfTEVGVEFSUk9XICA9IDM3O1xuICAgIHZhciBLRVlDT0RFX1JJR0hUQVJST1cgPSAzOTtcblxuICAgIHZhciBrZXljb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9FU0MpIHtcbiAgICAgIC8vIFByZXZlbnQgYnViYmxpbmcgc28gYXMgdG8gbm90IGFmZmVjdCBvdGhlciBjb21wb25lbnRzIG9uIHRoZSBwYWdlLlxuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmVuZCgpO1xuICAgIH0gZWxzZSBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9MRUZUQVJST1cpIHtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICE9PSAwKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAtIDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbWFnZSh0aGlzLmFsYnVtLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9SSUdIVEFSUk9XKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAhPT0gdGhpcy5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbWFnZSgwKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gQ2xvc2luZyB0aW1lLiA6LShcbiAgTGlnaHRib3gucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZGlzYWJsZUtleWJvYXJkTmF2KCk7XG4gICAgJCh3aW5kb3cpLm9mZigncmVzaXplJywgdGhpcy5zaXplT3ZlcmxheSk7XG4gICAgdGhpcy4kbGlnaHRib3guZmFkZU91dCh0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcbiAgICB0aGlzLiRvdmVybGF5LmZhZGVPdXQodGhpcy5vcHRpb25zLmZhZGVEdXJhdGlvbik7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVTY3JvbGxpbmcpIHtcbiAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnbGItZGlzYWJsZS1zY3JvbGxpbmcnKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIG5ldyBMaWdodGJveCgpO1xufSkpO1xuIl19
